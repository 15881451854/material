<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" id="vp"/>
    <title>下拉刷新，上拉加载</title>
    <link rel="stylesheet" href="../css/common_s.css">
    <link rel="stylesheet" href="../css/base.css">
    <script src="../js/jquery-3.2.1.js"></script>  
    <script src="../js/common_s.js"></script>
    <script src="../js/flex.js"></script>
    <script src="../../iscroll/iscroll-probe.js"></script>
    <style> 
        body{ background:#333; display:flex; flex-direction:column; }
        .header, .footer{ line-height:1.2rem; background:#58bc58; text-align:center; font-size:.533333rem; color:#fff; }
        #wrapper{ flex:1; overflow:hidden; }
        p{ color:#fff; text-align:center; font-size:.40625rem; line-height:1.25rem; }
        ul{ background: #fff; font-size:.4rem; position:relative; }
        .pullDown{ position:absolute; top:-1.25rem; left:0; width:100%; z-index:100; }
        .pullUp{ position:absolute; bottom:-1.25rem; left:0; width:100%; z-index:100; }
        li{ line-height:.46875rem; padding:.3125rem; color:#000; }
        .downLoosen{ display:none; }
        .upLoosen{ display:none; }
    </style>
</head>
<body>
    <div class="header">
        我是头部
    </div>

    <div id="wrapper">
        <div>
            <p class="pullDown">下拉刷新...</p>
            <p class="downLoosen">松开刷新...</p>
            <ul class="dataLine">
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsafasfas范德萨发生大发大师傅</li>
                <li>发送到发发的萨芬撒的范德萨发生大</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>发送到发送到发送到</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>发达撒发达撒发送的发送到发送到发送大发</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>发的萨芬撒发送的发达撒发送</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>发的萨芬撒发送法师打发士大夫</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>范德萨发生发生的发士大夫撒的发的发达撒</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
                <li>fdsfs辅导老师激发了电视剧福建省得了福建省的</li>
            </ul>
            <p class="pullUp">上拉加载...</p>
            <p class="upLoosen">松开加载...</p>
        </div>
    </div>

    <div class="footer">
        我是尾部
    </div>

    <script>

        var myScroll;
        myScroll = new IScroll('#wrapper', {
            scrollX: false,
            scrollY: true,
            click: false,
            probeType: 2,
            bounce: true
        });

        var pullDown = 1;     // 避免多次执行
        var pullUp = 1;
        var xx = 1;
        var downHeight = $(".pullDown").height();
        var upHeight = $(".pullUp").height();
        myScroll.on('scroll', function(){
            var y = myScroll.y;
            console.log(y);
            if(y >= downHeight && pullDown){
                $(".pullDown").addClass("refresh").hide();
                $(".downLoosen").show();
                myScroll.refresh();
                pullDown = 0;
                xx = 1;
                myScroll.minScrollY = 0;
            }
            // if(y < downHeight && xx){
            //     $(".pullDown").hide();
            //     // $(".downLoosen").hide();
            //     myScroll.refresh();
            //     xx = 0;
            //     pullDown = 1;
            // }       
            if(y < (myScroll.maxScrollY - upHeight) && pullUp){
                $(".pullUp").addClass("loading").hide();
                $(".upLoosen").show();
                myScroll.refresh();
                pullUp = 0;
            }
        });


        myScroll.on('scrollEnd', function(){
            // if($(".pullDown").hasClass("refresh")){
            //     $(".downLoosen").text("正在刷新...");
            //     common.loadingShow();
            //     setTimeout(function(){
            //         location.reload();
            //     }, 2000);
            // }

            // if($(".pullUp").hasClass("loading")){
            //     $(".upLoosen").text("正在加载...");
            //     setTimeout(function(){
            //         add();
            //         // 重置
            //         $(".pullUp").removeClass("loading").show();
            //         $(".upLoosen").text("松开加载...").hide();
            //         myScroll.refresh();
            //         pullUp = 1;
            //     }, 1000);
            // }
        });

        myScroll.on('refresh', function(){
            // var pullDown = 1;     // 避免多次执行
            // var pullUp = 1;
            // var xx = 1;
        });


        // 向列表添加数据
        function add(){
            common.loadingShow();
            var arr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
            var html = $.map(arr, function(item, index){
                return "<li>我是加载的第"+(index+1)+"条数据</li>"
            }).join("");
            $(".dataLine").append(html);
            common.loadingHide();
        }

    </script>
</body>
</html>