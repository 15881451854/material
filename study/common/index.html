<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdn.bootcss.com/vue/2.5.21/vue.js"></script>
    <script src="https://cdn.bootcss.com/vue-router/3.0.2/vue-router.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js"></script>
</head>

<body>
    <div id="app">
        <input type="text" v-if="show" v-model="msg.name" ref="show1">
    </div>

    <script>
        console.log(axios.CancelToken.source());
    function filterUrl(url){
        if(url.startsWith('http') || url.startsWith('https')){
            return url;
        };
        return basrUrl+"/"+url;
    }

    axios.interceptors.request.use(function (config) {
        console.log("请求开始了");
        return config;
    }, function (error) {
        // Do something with request error
        return Promise.reject(error);
    });
    
    // Add a response interceptor
    axios.interceptors.response.use(function (response) {
        console.log("请求结束了");
        return response;
    }, function (error) {
        // Do something with response error
        return Promise.reject(error);
    });
    
    function post(url, params){
        return new Promise((resolve, reject) => {
            axios({
                method: 'post',
                url: filterUrl(url),
                data: params || {},
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                timeout: 100,
                transformRequest: [function (data) {
                    let ret = ''
                    for (let it in data) {
                      ret += encodeURIComponent(it) + '=' + encodeURIComponent(data[it]) + '&'
                    }
                    return ret;
                  }]
            }).then(res => {
                resolve(res);
            }).catch(error => {
                reject(error);
            });
        });
    }

    function formatterDateTime() {
    var date=new Date()
    var month=date.getMonth() + 1
    var datetime = date.getFullYear()
        + ""// "年"
        + (month >= 10 ? month : "0"+ month)
        + ""// "月"
        + (date.getDate() < 10 ? "0" + date.getDate() : date
                .getDate())
        + ""
        + (date.getHours() < 10 ? "0" + date.getHours() : date
                .getHours())
        + ""
        + (date.getMinutes() < 10 ? "0" + date.getMinutes() : date
                .getMinutes())
        + ""
        + (date.getSeconds() < 10 ? "0" + date.getSeconds() : date
                .getSeconds());
    return datetime;
    }

    var vm = new Vue({
        el: '#app',
        data: function(){
            return {
                msg: {name: "jack"},
                show: false
            }
        },
        watch: {
            msg: {
                deep: true,
                handler: function(value, x){
                    console.log(value, x);
                }
            }
        },
        mounted: function(){
            this.show = true;
            this.$nextTick(function(){
                this.$refs.show1.focus();
            }),
            post("http://route.showapi.com/1287-1", {
                "showapi_timestamp": formatterDateTime(),
                "showapi_appid": 'a64348be58b7486bb31af997f729fd7d',
                "showapi_sign": '82135'
            }).then(function(res){
                console.log(res);
            }).catch(function(err){
                console.log(err);
            });
        }
        
    })
    </script>
</body>

</html>